## 为什么引入 node.js 做中间层

- `java+jsp`、`node+ejs`、都是数据直接在模板中渲染，耦合。`ajax`出来之后，似乎解决了这个问题，但是仍然存在 html 中整理数据的代码(浏览器做运算)
- `转发数据+渲染优化`：node 拿到 java 后端数据接口，做数据的清洗、拓展、整理工作，直接 render 到视图，避免了数据到了 html 再做运算，减少浏览器内存开销
- `路由设计+控制逻辑`：如果不使用 render，采用`ajax`，前端开发者可以在 node 层定义接口，自由度更高，起码我自己记得住曾经写过的接口

## wepy 小程序项目总结

10 多天时间，结束了小程序项目的开发，采用前后端分离，遇到问题很多，按照项目的开发路径，大致可分为：

- 需求讨论
- 评审 PRD
- UI 出图
- ...产品若干修改
- 前端切图
- ...产品若干修改
- 后端写接口
- 后端出文档
- 前后端联调
- 改 BUG
- 项目上线

由于是前后端分离，总结也主要从前、后两端开展

#### 后端

后端两位大佬，各自写自己实体类，导致接口返回字段不同，例如两个接口同一个数据库字段`nickname`，接口中就变成`nikename`和`nickName`，这个当然是小问题，认真看文档是可以解决的，但是比较致命的问题，是`无返回值`的情况，例如

```js
{
  "info": {},
  "result": {},
  "resultCode": 0,
  "resultMessage": "string",
  "success": true
}
```

有时候`result`返回为`[]`，有时候为`null`，这个就导致了前端在`server`层对数据进行清洗处理的时候，如果你单单写`if(res.result)`会造成`xxx is note defined`的情况，这个有点蛋疼，并且在小程序中，如果牵扯到页面传参，这个问题就直接导致了，下一个页面拿到的参数是`""`，当在页面中对`vm`进行判断的时候，就会出现这样的代码`<view class="{{xxx!==null && xxx!=='' && xxx!=='null' ? 'isActive' : ''}}"></view>`

#### 前端

剩下就是总结自己的问题了，首先是大方向上，感觉时间明明是够的，加班也不是很疲惫，毕竟项目没有太复杂的逻辑，然而就是感觉不流畅，项目结束就想重构

- 在看 prd 的时候，就有点迷，进入项目、业务场景的速度太慢，说白了，不能快速的串联 prd，弄清楚页面交互逻辑关系
- UI 出图后，会多次进行修改，看到页面就是干，各种突突突，没有认真审一遍所有的页面，导致了 UI 在改图后，有种菊花疼的感觉(用第三方组件库，我是拒绝的，和 UI 图匹配度太低，第二占用小程序空间，万一有坑也很难受)。对于复用样式，复用组件，在项目开始前，审一遍全部的 UI 图，老老实实写`common.less`(已经同步到`wepy`分类下)，大有裨益
- 因为是小程序，用假数据对页面的`上拉`刷新进行测试，后端普遍做法是给你`pageNum`、`pageSize`，你去判断拉的数据是否为`null`或者`result.length<pageSize`，代表下拉终止，这是移动端的惯例，因为不需要显示页码数量。
- 看 UI 图的时候，着重注意页面`入口`，当某个页面存在多个`入口`时，展示的内容不同，就要谨慎点，不能脏一堆代码，导致维护性巨烂无比
- 此外不要轻易用组件，因为组件渲染在小程序的表现效果不是很好，默认值会显示(一闪而过)，然后`this.$apply()`这个过程体验非常雷 sui，如果硬要组件，默认值给空或者''
- 串页面如果比较费劲，需要带很多参数，做判断，大胆找后端商量，是不是接口不合理，一般来说页面传参不应该超过 3 个
- 前端`防暴力点击`，没有在做页面的时候去做好，导致项目在第二轮测试的时候，才加上按钮的`暴力点击`开关，尿崩了都！
- 各种提示信息没做处理，交互上面不是很舒服，包括加载小菊花

#### 沟通

从项目的流程上看，因为项目体量并不大，在 UI 出图后，前后端直接就各自为战了，没有一起审页面，讨论接口，这个导致了接口上面出现一些沟通上的问题，无法快速定位接口，熟悉度不够，联调直接喊话的模式，或者跑去工位提问，效率挺高的，比项目管理工具体验要好，有问题基本可以快速得到解决、响应

#### 规范

纵观整个项目，代码比较乱，`Promise`、`aysnc await`混用， 丢掉了代码注释的习惯，致使`vscode`快速定位页面功能点变慢。无论是从后端接口，还是前端页面、`js`，都初期少量功能开发，缺少规范，并不会多影响效率，但在多人合作的模式下，代码量一旦增加，缺少规范将导致伙伴很难帮你修改代码，不敢动你代码，倘若你请假的话
